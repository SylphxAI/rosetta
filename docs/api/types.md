# TypeScript Types

Complete type reference for Rosetta packages.

## Core Types

### SourceString

A source string extracted from code:

```ts
interface SourceString {
  /** 8-character hash */
  hash: string;

  /** Original text from code */
  text: string;

  /** Optional context for disambiguation */
  context?: string | null;
}
```

### Translation

A stored translation:

```ts
interface Translation {
  /** Translated text */
  text: string;

  /** Whether AI-generated */
  autoGenerated: boolean;

  /** Whether human-reviewed */
  reviewed: boolean;

  /** Hash of source at translation time */
  sourceHash?: string | null;

  /** @deprecated Full source text */
  translatedFrom?: string | null;
}
```

### TranslationStatus

Status of a translation:

```ts
type TranslationStatus =
  | 'missing'      // No translation
  | 'outdated'     // Source changed
  | 'unreviewed'   // AI-generated, not reviewed
  | 'reviewed'     // Human-reviewed
  | 'current';     // Up-to-date
```

### LocaleInfo

Information about a locale:

```ts
interface LocaleInfo {
  /** Locale code (e.g., 'zh-TW') */
  code: string;

  /** English name (e.g., 'Chinese (Traditional)') */
  name: string;

  /** Native name (e.g., '繁體中文') */
  nativeName: string;
}
```

---

## Storage Adapter Types

### StorageAdapter

Interface for storage backends:

```ts
interface StorageAdapter {
  getTranslations(locale: string): Promise<Map<string, string>>;

  saveTranslation(
    locale: string,
    hash: string,
    text: string,
    options?: SaveTranslationOptions
  ): Promise<void>;

  getSources(): Promise<SourceString[]>;

  getUntranslated(locale: string): Promise<SourceString[]>;

  getAvailableLocales(): Promise<string[]>;

  // Optional
  getSourcesWithTranslations?(
    locales: string[]
  ): Promise<SourceWithTranslations[]>;

  saveTranslations?(
    locale: string,
    translations: Map<string, string>
  ): Promise<void>;

  markAsReviewed?(locale: string, hash: string): Promise<void>;
}
```

### SaveTranslationOptions

```ts
interface SaveTranslationOptions {
  /** Whether AI-generated */
  autoGenerated?: boolean;

  /** 8-char hash of source for staleness */
  sourceHash?: string;

  /** @deprecated Full source text */
  translatedFrom?: string;
}
```

### SourceWithTranslations

```ts
interface SourceWithTranslations {
  hash: string;
  text: string;
  context?: string | null;
  translations: Record<string, {
    text: string | null;
    autoGenerated: boolean;
    reviewed: boolean;
    sourceHash?: string | null;
    translatedFrom?: string | null;
  } | null>;
}
```

---

## Cache Adapter Types

### CacheAdapter

Interface for caching:

```ts
interface CacheAdapter {
  get(locale: string): Promise<Map<string, string> | null>;
  set(locale: string, translations: Map<string, string>): Promise<void>;
  invalidate(locale?: string): Promise<void>;
  has(locale: string): Promise<boolean>;
}
```

### InMemoryCacheOptions

```ts
interface InMemoryCacheOptions {
  /** TTL in milliseconds (default: 5 min) */
  ttlMs?: number;

  /** Max entries for LRU (default: 100) */
  maxEntries?: number;
}
```

### ExternalCacheOptions

```ts
interface ExternalCacheOptions {
  /** Key prefix (default: 'rosetta:') */
  prefix?: string;

  /** TTL in seconds (default: 300) */
  ttlSeconds?: number;
}
```

---

## Next.js Types

### RosettaProviderProps

```ts
interface RosettaProviderProps {
  /** Rosetta instance */
  rosetta: Rosetta;

  /** Current locale */
  locale: string;

  /** Children */
  children: ReactNode;

  /** Optional: specific hashes to load */
  hashes?: string[];
}
```

### TranslateFunction

```ts
type TranslateFunction = (
  text: string,
  paramsOrOptions?: Record<string, string | number> | TranslateOptions
) => string;
```

### TranslateOptions

```ts
interface TranslateOptions {
  /** Context for disambiguation */
  context?: string;

  /** Interpolation parameters */
  params?: Record<string, string | number>;
}
```

### TranslationContextValue

```ts
interface TranslationContextValue {
  locale: string;
  defaultLocale: string;
  t: TranslateFunction;
}
```

### SetLocaleCookieOptions

```ts
interface SetLocaleCookieOptions {
  path?: string;
  maxAge?: number;
  sameSite?: 'strict' | 'lax' | 'none';
  secure?: boolean;
}
```

---

## Admin Types

### SourceEntry

```ts
interface SourceEntry {
  sourceHash: string;
  sourceText: string;
  effectiveSource: string;
  context?: string | null;
  translations: Record<string, TranslationData | null>;
}
```

### TranslationData

```ts
interface TranslationData {
  text: string | null;
  auto: boolean;
  reviewed: boolean;
  outdated: boolean;
  translatedFrom?: string | null;
}
```

### LocaleStats

```ts
interface LocaleStats {
  translated: number;
  reviewed: number;
  outdated: number;
  total: number;
}
```

### TranslationStatsData

```ts
interface TranslationStatsData {
  totalStrings: number;
  locales: Record<string, LocaleStats>;
}
```

### AdminState

```ts
interface AdminState {
  sources: SourceEntry[];
  locales: string[];
  stats: TranslationStatsData;
  view: 'dashboard' | 'editor';
  activeLocale: string | null;
  searchQuery: string;
  statusFilter: StatusFilter;
  editingHash: string | null;
  isLoading: boolean;
  batchProgress: Record<string, LocaleBatchProgress | null>;
  error: string | null;
}
```

### StatusFilter

```ts
type StatusFilter = 'all' | 'missing' | 'outdated' | 'unreviewed' | 'reviewed';
```

### AdminAPIClient

```ts
interface AdminAPIClient {
  fetchTranslations(): Promise<FetchTranslationsResponse>;
  saveTranslation(request: SaveTranslationRequest): Promise<void>;
  markAsReviewed(request: MarkAsReviewedRequest): Promise<void>;
  batchTranslate(request: BatchTranslateRequest): Promise<BatchTranslateResponse>;
  batchTranslateStream?(
    request: BatchTranslateRequest,
    callbacks: BatchTranslateStreamCallbacks
  ): Promise<void>;
  addLocale?(locale: string): Promise<void>;
  removeLocale?(locale: string): Promise<void>;
}
```

---

## Translator Types

### TranslateFunction (Admin)

```ts
type TranslateFunction = (
  items: BatchTranslationItem[],
  targetLocale: string
) => Promise<Array<{ sourceHash: string; translatedText: string }>>;
```

### BatchTranslationItem

```ts
interface BatchTranslationItem {
  sourceHash: string;
  sourceText: string;
  context?: string | null;
}
```

### AiSdkTranslatorConfig

```ts
interface AiSdkTranslatorConfig {
  model: LanguageModel;
  batchSize?: number;
  systemPrompt?: (locale: string, localeName: string) => string;
}
```

---

## Validation Constants

```ts
const MAX_TEXT_LENGTH = 50000;
const MAX_LOCALE_LENGTH = 10;
const MAX_CONTEXT_LENGTH = 255;
const MAX_HASH_LENGTH = 8;
const MAX_BATCH_SIZE = 1000;
```

---

## Importing Types

```ts
// Core
import type {
  SourceString,
  StorageAdapter,
  CacheAdapter,
  SaveTranslationOptions,
} from '@sylphx/rosetta';

// Server
import type {
  Rosetta,
  RosettaContext,
  TranslateFunction,
} from '@sylphx/rosetta-next/server';

// Next.js
import type {
  RosettaProviderProps,
  TranslateOptions,
  LocaleInfo,
} from '@sylphx/rosetta-next';

// Admin
import type {
  SourceEntry,
  TranslationData,
  AdminState,
  AdminAPIClient,
} from '@sylphx/rosetta-admin';

// Drizzle
import type {
  DrizzleStorageAdapterConfig,
  SourcesTable,
  TranslationsTable,
} from '@sylphx/rosetta-drizzle';
```

## See Also

- [Storage Adapter](/advanced/storage-adapter)
- [Translate Adapter](/advanced/translate-adapter)
- [Admin Dashboard](/packages/rosetta-admin)
